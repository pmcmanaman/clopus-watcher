# Clopus Watcher Helm Chart Values

# Namespace configuration
namespace:
  create: true
  name: clopus-watcher

# Watcher configuration
watcher:
  # Schedule for the CronJob (cron format)
  schedule: "*/5 * * * *"

  # Target namespace to monitor
  targetNamespace: "default"

  # Watcher mode: "autonomous" (detect and fix) or "report" (detect only)
  mode: "autonomous"

  # Enable proactive checks (detect potential issues before they cause failures)
  proactiveChecks: false

  image:
    repository: ghcr.io/pmcmanaman/clopus-watcher
    tag: latest
    pullPolicy: Always

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  # CronJob settings
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  backoffLimit: 0
  ttlSecondsAfterFinished: 300

# Dashboard configuration
dashboard:
  enabled: true

  replicas: 1

  image:
    repository: ghcr.io/pmcmanaman/clopus-watcher-dashboard
    tag: latest
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 80
    targetPort: 8080

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

  # Health check configuration
  livenessProbe:
    enabled: true
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 10

  readinessProbe:
    enabled: true
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 5

  # Ingress configuration
  ingress:
    enabled: false
    className: ""
    annotations: {}
      # kubernetes.io/ingress.class: nginx
      # cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: clopus.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: clopus-tls
    #    hosts:
    #      - clopus.local

# Authentication configuration
auth:
  # Mode: "api-key" or "credentials"
  mode: "api-key"

  # API key authentication (when mode is "api-key")
  apiKey:
    # Use existing secret instead of creating one
    existingSecret: ""
    # Secret key name
    secretKey: "api-key"
    # API key value (only used if existingSecret is empty)
    # WARNING: For production, use existingSecret or external secrets management
    value: ""

  # Credentials authentication (when mode is "credentials")
  credentials:
    # Existing secret containing credentials.json
    existingSecret: ""
    # Key in the secret containing credentials.json
    secretKey: "credentials.json"

# Persistence configuration
persistence:
  enabled: true

  # Use existing PVC
  existingClaim: ""

  # Storage class (leave empty for default)
  storageClassName: ""

  # Access mode
  accessMode: ReadWriteOnce

  # Storage size
  size: 1Gi

  # Annotations for PVC
  annotations: {}

# RBAC configuration
rbac:
  create: true

  # Use ClusterRole (true) or Role (false)
  # ClusterRole is needed to monitor pods across namespaces
  clusterWide: true

# Service account configuration
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Image pull secrets for private registries
imagePullSecrets: []
  # - name: regcred

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext: {}
  # fsGroup: 2000

# Container security context
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
