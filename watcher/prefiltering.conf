# Prefiltering Configuration for CLOPUS Watcher
# This file defines rules to filter and prioritize issues before Claude analysis

# Global prefiltering settings
GLOBAL_ENABLED=true
LOG_PREFILTERING=true
MAX_PREFILTER_TIME=30

# Pod priority filtering
POD_PRIORITY_FILTERS=true
HIGH_PRIORITY_LABELS="priority=high,critical=true,business-critical=true"
IGNORE_LABELS="ignore=true,maintenance-mode=true,debug-pod=true"

# Time-based filtering
RECENT_SUCCESSFUL_FIX_WINDOW=30  # minutes
MIN_ERROR_AGE=5  # minutes - ignore errors newer than this
MAX_ERROR_AGE=1440  # minutes - ignore errors older than this

# Namespace priority weighting
NAMESPACE_PRIORITY_ENABLED=true
HIGH_PRIORITY_NAMESPACES="prod,production,main,primary"
MEDIUM_PRIORITY_NAMESPACES="staging,qa,testing"
LOW_PRIORITY_NAMESPACES="dev,development,experimental"

# Error pattern filtering
ERROR_PATTERN_FILTERING=true
# Patterns to ignore (false positives)
IGNORE_ERROR_PATTERNS=".*Readiness probe failed.*timeout.*,\
.*Back-off restarting failed container.*,\
.*Liveness probe failed.*connection refused.*,\
.*Warning:.*deprecated.*,\
.*Debug:.*"

# Critical error patterns (always analyze)
CRITICAL_ERROR_PATTERNS=".*OOMKilled.*,\
.*CrashLoopBackOff.*,\
.*ImagePullBackOff.*,\
.*FailedMount.*,\
.*FailedScheduling.*,\
.*Unhealthy.*,\
.*PodSecurityPolicy.*"

# Resource-based filtering
RESOURCE_FILTERING=true
MIN_CPU_THRESHOLD=10  # millicores
MIN_MEMORY_THRESHOLD=50  # MB
HIGH_CPU_THRESHOLD=80  # percent
HIGH_MEMORY_THRESHOLD=90  # percent

# Application-specific filtering
APP_SPECIFIC_FILTERING=true
# Add application-specific rules here
# Example: DATABASE_ERROR_PATTERNS=".*connection.*timeout.*"

# Learning-based filtering
LEARNING_FILTERING=true
MIN_HISTORY_ENTRIES=5  # minimum entries to make decisions
SUCCESS_RATE_THRESHOLD=0.7  # 70% success rate to trust historical data

# Prefiltering limits
MAX_PODS_PER_NAMESPACE=20
MAX_NAMESPACES_PER_RUN=10
MAX_ERRORS_PER_POD=5

# Safety limits
MAX_PREFILTER_MEMORY=100  # MB
MAX_CLAUDE_CALLS_PER_RUN=50